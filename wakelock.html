<html>
<head>
<title>Wake Lock Test</title>
<meta http-equiv="origin-trial" content="ArzyCxKqQgknW5KRfNQTfQ+lOBwrVlYwbcd2rm3llPLm7289KP974l5cB3GyNL+hNL2jdD7g5nnh6mOjfd9l8goAAABVeyJvcmlnaW4iOiJodHRwczovL3JlaWxseWVvbi5naXRodWIuaW86NDQzIiwiZmVhdHVyZSI6Ildha2VMb2NrIiwiZXhwaXJ5IjoxNTg2OTExODcyfQ==">
</head>
<body>
<p>Click a button below to acquire or release a wake lock.</p>
<p><button id="screen">Screen</button> <span id="screen_status"></span></p>
<p><button id="system">System</button> <span id="system_status"></span></p>
<script>
[ 'screen', 'system' ].forEach(type => {
  const button = document.getElementById(type);
  const label = document.getElementById(type + '_status');

  if ('WakeLock' in window && 'request' in WakeLock) {
    // API implemented in Chrome 78.
    let controller;

    button.addEventListener('click', async () => {
      if (controller) {
        controller.abort();
        return;
      }

      controller = new AbortController();
      try {
        label.textContent = 'Acquired';
        await WakeLock.request(type, { signal: controller.signal });
      } catch (e) {
        if (e.name == 'AbortError') {
          label.textContent = 'Released';
        } else {
          label.textContent = `${e.name}: ${e.message}`;
        }
      }
      controller = undefined;
    });
  } else if ('wakeLock' in navigator) {
    // API implemented in Chrome 79.
    let lock;

    button.addEventListener('click', async () => {
      if (lock) {
        lock.release();
        return;
      }

      try {
        lock = await navigator.wakeLock.request(type);
        label.textContent = 'Acquired';

        lock.addEventListener('release', () => {
          label.textContent = 'Released';
          lock = null;
        });
      } catch (e) {
        label.textContent = `${e.name}: ${e.message}`;
      }
    });
  } else {
    label.textContent = 'Not supported';
  }
});
</script>
</body>
</html>
